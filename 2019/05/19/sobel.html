<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width", initial-scale=1.0>
    <meta name="description" content="George Pearsons' Blog | A look at Sobel edge detection using HTML canvas and JavaScript.">
    <title>Sobel Edge Detection | George Pearson</title>
    <link rel="stylesheet" href="/assets/css/main.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css">
    <link rel="shortcut icon" type="image/x-icon" href="/assets/images/favicon.ico">
    
<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-134616286-1"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-134616286-1');
</script>

</head>

  <body>
    <header>
    <a href="/" aria-label="home"><div class="ma-boi"></div></a>
    <nav>
    <ul role="navigation" class="hidden">
    <li><a href="/">Home</a></li>
    <li><a href="/about">About</a></li>
    <li><a href="/photos">Photos</a></li>
    </ul>
</nav>
</header>
		<main role="main">
			<section class="post">
    <div class="post-header">
        <h1>Sobel Edge Detection</h1>
        <p class="post-date">May 19, 2019</p>
        <a class="blue-link" data-disqus-identifier="/2019/05/19/sobel" href="https://georgepearson.co.uk/2019/05/19/sobel.html#disqus_thread">Comments</a>
    </div>
    <p>I recently watched a <a class="blue-link" href="https://youtu.be/uihBwtPIBxM">Computerphile YouTube video</a> about Sobel edge detection and thought Iâ€™d write a post about it. In Sobel edge detection a <a href="https://en.wikipedia.org/wiki/Sobel_operator" class="blue-link">Sobel operation</a> is applied to an image in order to detect shapes/edges in the image. The main application of edge detection is in robotic vision, for example allowing self-driving vehicles to detect motorway lanes, but it can be used for any image analysis.</p>

<p>The first step in the Sobel operation is to <a href="https://en.wikipedia.org/wiki/Grayscale" class="blue-link">greyscale</a> the image. This can be done with a few lines of JavaScript code:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">gsFigure</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">"#fig-greyscale"</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">gsImage</span> <span class="o">=</span> <span class="nx">gsFigure</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">"img"</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">gsCanvas</span> <span class="o">=</span> <span class="nx">gsFigure</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">"canvas"</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">gsbutton</span> <span class="o">=</span> <span class="nx">gsFigure</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">".button"</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">gsCtx</span> <span class="o">=</span> <span class="nx">gsCanvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s2">"2d"</span><span class="p">);</span>

<span class="nx">gsbutton</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">gsCanvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">gsImage</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
  <span class="nx">gsCanvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">gsImage</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
  <span class="nx">gsCtx</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="nx">gsImage</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">gsImageData</span> <span class="o">=</span> <span class="nx">gsCtx</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">gsCanvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">gsCanvas</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">greyScale</span><span class="p">(</span><span class="nx">gsImageData</span><span class="p">);</span>
  <span class="nx">gsCtx</span><span class="p">.</span><span class="nx">putImageData</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">greyScale</span> <span class="p">(</span><span class="nx">imageData</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="nx">imageData</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">d</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">+=</span><span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">d</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
    <span class="kd">var</span> <span class="nx">g</span> <span class="o">=</span> <span class="nx">d</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
    <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">d</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">2</span><span class="p">];</span>
    <span class="c1">// CIE luminance for RGB</span>
    <span class="c1">// Human vision is most sensitive to green, so this has the greatest coefficient value.</span>
    <span class="kd">var</span> <span class="nx">v</span> <span class="o">=</span> <span class="mf">0.2126</span><span class="o">*</span><span class="nx">r</span> <span class="o">+</span> <span class="mf">0.7152</span><span class="o">*</span><span class="nx">g</span> <span class="o">+</span> <span class="mf">0.0722</span><span class="o">*</span><span class="nx">b</span><span class="p">;</span>
    <span class="nx">d</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">d</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">d</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">imageData</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></div>

<figure id="fig-greyscale">
    <div style="overflow-x: scroll;">
        <img style="display:block;" src="/assets/images/flower.png" />
        <canvas style="display:none;"></canvas>
    </div>
    <button class="button">Apply</button>
</figure>

<p>The next step in the Sobel operation is to <a class="blue-link" href="https://en.wikipedia.org/wiki/Kernel_(image_processing)#Convolution">convolve<a> the image with two 3x3 <a class="blue-link" href="https://en.wikipedia.org/wiki/Kernel_(image_processing)">kernels</a>, <code class="highlighter-rouge">Gx</code> and <code class="highlighter-rouge">Gy</code>. What this basically means is the strength of each pixel is weighted by its neighbours. The magnitude of <code class="highlighter-rouge">Gx</code> is greatest when the pixels to the right and left of the pixel being convolved are most different, whereas the magnitude of <code class="highlighter-rouge">Gy</code> is greatest when the pixels above and below are most different. <code class="highlighter-rouge">Gx</code> and <code class="highlighter-rouge">Gy</code> can therefore be considered gradient functions and effectively emphasise edges in the x and y directions respectively.</a></a></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     <span class="o">|-</span><span class="mi">1</span> <span class="mi">0</span> <span class="o">+</span><span class="mi">1</span><span class="o">|</span>               <span class="o">|-</span><span class="mi">1</span> <span class="o">-</span><span class="mi">2</span> <span class="o">-</span><span class="mi">1</span><span class="o">|</span>
<span class="nx">Gx</span> <span class="o">=</span> <span class="o">|-</span><span class="mi">2</span> <span class="mi">0</span> <span class="o">+</span><span class="mi">2</span><span class="o">|</span> <span class="o">*</span> <span class="nx">A</span>  <span class="p">,</span>   <span class="nx">Gy</span> <span class="o">=</span> <span class="o">|</span> <span class="mi">0</span>  <span class="mi">0</span>  <span class="mi">0</span><span class="o">|</span> <span class="o">*</span> <span class="nx">A</span>  <span class="p">,</span>  <span class="nx">where</span> <span class="nx">A</span> <span class="nx">is</span> <span class="nx">the</span> <span class="nx">source</span> <span class="nx">image</span><span class="p">.</span>
     <span class="o">|-</span><span class="mi">1</span> <span class="mi">0</span> <span class="o">+</span><span class="mi">1</span><span class="o">|</span>               <span class="o">|+</span><span class="mi">1</span> <span class="o">+</span><span class="mi">2</span> <span class="o">+</span><span class="mi">1</span><span class="o">|</span>
</code></pre></div></div>
<p>The gradient functions can be combined to form a gradient magnitude <code class="highlighter-rouge">G = sqrt(Gx<sup>2</sup> + Gy<sup>2</sup>)</code>. This produces an image where all the areas with large changes in pixel intensity (edges) are highlighted, just hit the button below to see an example:</p>

<figure id="fig-sobel">
    <div style="overflow-x: scroll;">
        <img style="display:block;" src="/assets/images/flower.png" />
        <canvas style="display:none;"></canvas>
    </div>
    <button class="button">Apply</button>
</figure>

<figure class="half-width-left" style="justify-self: center;">
    <img src="/assets/images/colourWheel.png" />
</figure>
<p class="half-width-right">
In fact we can even find out the orientation of the edges by taking the arctan of the gradient functions, <code class="highlighter-rouge">Î¸ = atan(Gy/Gx)</code>. The orientation can then be mapped to a colour using a colour wheel. Try running the example Sobel operation below:
</p>

<figure id="fig-sobel-colour">
    <div style="overflow-x: scroll;">
        <img style="display:block;" src="/assets/images/flower.png" />
        <canvas style="display:none;"></canvas>
    </div>
    <button class="button">Apply</button>
</figure>
<p>Wow thatâ€™s pretty fancy! Notice how the edges orientation maps to that of the colour wheel.</p>

<p>Finally have a play with this a JavaScript tool to create your own Sobel images below. The saturation input controls the amount of orientational colour added. Also Iâ€™ve set it to scale the images to 600px for performance.</p>

<div id="loader-tool">
    <button id="select" class="button">Select an Image</button>
    <input accept="image/*" id="fileInput" style="display:none;" type="file" />
    <div style="padding:1em 0 1em 0;">
        <label for="saturation">Saturation:</label>
        <input id="saturation" type="range" step="0.01" min="0" max="1" value="1" />
        <span style="padding:0 1em 0 1em;" id="saturationValueDisplay">1</span>
    </div>
    <button style="display:none;" id="apply" class="button">Apply</button>
    <div style="overflow-x: scroll; padding-top:1em;">
        <canvas></canvas>
    </div>
</div>

<h2 id="further-reading--watching">Further reading / watching</h2>
<ul>
  <li><a class="blue-link" href="https://youtu.be/uihBwtPIBxM">Finding the Edges (Sobel Operator) - Computerphile</a></li>
  <li><a class="blue-link" href="https://www.html5rocks.com/en/tutorials/canvas/imagefilters/">Image Filters with Canvas</a></li>
</ul>

<script src="/assets/scripts/sobel.min.js"></script>


    <div id="disqus_thread"></div>
</section>
<script id="dsq-count-scr" src="//georgepearson-co-uk.disqus.com/count.js" async></script>
<script>
    var disqus_config = function () {
    this.page.url = "https://georgepearson.co.uk/2019/05/19/sobel.html";
    this.page.identifier = "/2019/05/19/sobel";
    };

    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://georgepearson-co-uk.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>
    Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>

		</main>
    <footer>
        <ul class="social-icons">
                <li><a aria-label="Github" href="https://github.com/george-pearson"><i class="fab fa-github-alt fa-3x"></i></a></li>
                <li><a aria-label="LinkedIn" href="https://linkedin.com/in/george-pearson-27244a30/"><i class="fab fa-linkedin fa-3x"></i></a></li>
                <li><a aria-label="Mail" href="mailto:george-pearson.business@outlook.com"><i class="far fa-envelope fa-3x"></i></a></li>
        </ul>
        <p>&copy; George Pearson 2019</p>
</footer>
  </body>
</html>