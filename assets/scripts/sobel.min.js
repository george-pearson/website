"use strict";!function(){var t=document.querySelector("#fig-greyscale"),a=t.querySelector("img"),r=t.querySelector("canvas"),i=t.querySelector(".button");r.width=a.width,r.height=a.height;var n=r.getContext("2d");n.drawImage(a,0,0);var h=!1;function f(t){for(var e=t.data,a=0;a<e.length;a+=4){var r=.2126*e[a]+.7152*e[a+1]+.0722*e[a+2];e[a]=e[a+1]=e[a+2]=r}return t}i.addEventListener("click",function(){var t=n.getImageData(0,0,r.width,r.height);if(h)n.drawImage(a,0,0),i.text="Apply",h=!1;else{var e=f(t);n.putImageData(e,0,0),i.text="Reload",h=!0}});var e=document.querySelector("#fig-sobel"),o=e.querySelector("img"),d=e.querySelector("canvas"),c=e.querySelector(".button");d.width=o.width,d.height=o.height;var l=d.getContext("2d");l.drawImage(o,0,0);var g=!1;c.addEventListener("click",function(){var t=l.getImageData(0,0,d.width,d.height);if(g)l.drawImage(o,0,0),c.text="Apply",g=!1;else{var e=E(t,d,0);l.putImageData(e,0,0),c.text="Reload",g=!0}});var u=document.querySelector("#fig-sobel-colour"),v=u.querySelector("img"),s=u.querySelector("canvas"),w=u.querySelector(".button");s.width=v.width,s.height=v.height;var y=s.getContext("2d");y.drawImage(v,0,0);var m=!1;w.addEventListener("click",function(){var t=y.getImageData(0,0,s.width,s.height);if(m)y.drawImage(v,0,0),w.text="Apply",m=!1;else{var e=E(t,s,1);y.putImageData(e,0,0),w.text="Reload",m=!0}});var q,I=document.querySelector("#loader-tool"),S=I.querySelector("#select"),p=I.querySelector("#fileInput"),M=I.querySelector("canvas"),x=M.getContext("2d"),b=I.querySelector("#saturation"),k=I.querySelector("#saturationValueDisplay"),D=I.querySelector("#apply");b.addEventListener("change",function(t){k.innerHTML=b.value}),S.addEventListener("click",function(){p.click()}),p.addEventListener("change",function(t){var e=new FileReader;e.onload=function(t){(q=new Image).onload=function(){A(q,600,M,x)},q.src=t.target.result,D.style="display: inline;"};var a=t.target.files[0];a&&a.type.match("image.*")&&e.readAsDataURL(a)});var L=!1;function A(t,e,a,r){var i=1;(e<t.width||e<t.height)&&(i=Math.min(e/t.width,e/t.height)),a.width=t.width*i,a.height=t.height*i,r.drawImage(t,0,0,a.width,a.height)}function E(t,e,a){for(var r=e.getContext("2d"),i=f(t),n=R(i,[-1,-2,-1,0,0,0,1,2,1]),h=R(i,[-1,0,1,-2,0,2,-1,0,1]),o=new Float32Array(i.width*i.height*4),d=new Float32Array(i.width*i.height*4),c=-1,l=0;l<i.data.length;l+=4){var g=n.data[l],u=h.data[l];o[l]=Math.sqrt(u*u+g*g),o[l]>c&&(c=o[l]),d[l]=Math.atan2(g,u)+Math.PI}var v=r.getImageData(0,0,e.width,e.height);for(l=0;l<v.data.length;l+=4){var s=C(d[l]/(2*Math.PI),a,o[l]/c);v.data[l]=s.r,v.data[l+1]=s.g,v.data[l+2]=s.b,v.data[l+3]=255}return v}function R(t,e){for(var a=Math.round(Math.sqrt(e.length)),r=Math.floor(a/2),i=t.data,n=t.width,h=t.height,o=n,d=h,c={width:o,height:d,data:new Float32Array(o*d*4)},l=c.data,g=0;g<d;g++)for(var u=0;u<o;u++){for(var v=g,s=u,f=4*(g*o+u),w=0,y=0,m=0,q=0,I=0;I<a;I++)for(var S=0;S<a;S++){var p=4*(Math.min(h-1,Math.max(0,v+I-r))*n+Math.min(n-1,Math.max(0,s+S-r))),M=e[I*a+S];w+=i[p]*M,y+=i[p+1]*M,m+=i[p+2]*M,q+=i[p+3]*M}l[f]=w,l[f+1]=y,l[f+2]=m,l[f+3]=q}return c}function C(t,e,a){var r,i,n,h,o,d,c,l;switch(1===arguments.length&&(e=t.s,a=t.v,t=t.h),d=a*(1-e),c=a*(1-(o=6*t-(h=Math.floor(6*t)))*e),l=a*(1-(1-o)*e),h%6){case 0:r=a,i=l,n=d;break;case 1:r=c,i=a,n=d;break;case 2:r=d,i=a,n=l;break;case 3:r=d,i=c,n=a;break;case 4:r=l,i=d,n=a;break;case 5:r=a,i=d,n=c}return{r:Math.round(255*r),g:Math.round(255*i),b:Math.round(255*n)}}D.addEventListener("click",function(){var t=x.getImageData(0,0,M.width,M.height);if(L)A(q,600,M,x),D.text="Apply",L=!1;else{var e=E(t,M,b.value);x.putImageData(e,0,0),D.text="Reload",L=!0}})}();