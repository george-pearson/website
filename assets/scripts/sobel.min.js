"use strict";!function(){var e=document.querySelector("#fig-greyscale"),a=e.querySelector("img"),r=e.querySelector("canvas"),n=e.querySelector(".button");r.width=a.width,r.height=a.height;var i=r.getContext("2d");i.drawImage(a,0,0),a.addEventListener("load",function(){i.drawImage(a,0,0)});var d=!1;function f(e){for(var t=e.data,a=0;a<t.length;a+=4){var r=.2126*t[a]+.7152*t[a+1]+.0722*t[a+2];t[a]=t[a+1]=t[a+2]=r}return e}n.addEventListener("click",function(){var e=i.getImageData(0,0,r.width,r.height);if(d)i.drawImage(a,0,0),n.text="Apply",d=!1;else{var t=f(e);i.putImageData(t,0,0),n.text="Reload",d=!0}});var t=document.querySelector("#fig-sobel"),o=t.querySelector("img"),h=t.querySelector("canvas"),c=t.querySelector(".button");h.width=o.width,h.height=o.height;var l=h.getContext("2d");l.drawImage(o,0,0),o.addEventListener("load",function(){l.drawImage(o,0,0)});var g=!1;c.addEventListener("click",function(){var e=l.getImageData(0,0,h.width,h.height);if(g)l.drawImage(o,0,0),c.text="Apply",g=!1;else{var t=A(e,h,0);l.putImageData(t,0,0),c.text="Reload",g=!0}});var u=document.querySelector("#fig-sobel-colour"),v=u.querySelector("img"),s=u.querySelector("canvas"),w=u.querySelector(".button");s.width=v.width,s.height=v.height;var m=s.getContext("2d");m.drawImage(v,0,0),v.addEventListener("load",function(){m.drawImage(v,0,0)});var y=!1;w.addEventListener("click",function(){var e=m.getImageData(0,0,s.width,s.height);if(y)m.drawImage(v,0,0),w.text="Apply",y=!1;else{var t=A(e,s,1);m.putImageData(t,0,0),w.text="Reload",y=!0}});var I,q=document.querySelector("#loader-tool"),S=q.querySelector("#select"),p=q.querySelector("#fileInput"),M=q.querySelector("canvas"),x=M.getContext("2d"),b=q.querySelector("#saturation"),L=q.querySelector("#saturationValueDisplay"),k=q.querySelector("#apply");b.addEventListener("change",function(e){L.innerHTML=b.value}),S.addEventListener("click",function(){p.click()}),p.addEventListener("change",function(e){var t=new FileReader;t.onload=function(e){(I=new Image).onload=function(){E(I,600,M,x)},I.src=e.target.result,k.style="display: inline;"};var a=e.target.files[0];a&&a.type.match("image.*")&&t.readAsDataURL(a)});var D=!1;function E(e,t,a,r){var n=1;(t<e.width||t<e.height)&&(n=Math.min(t/e.width,t/e.height)),a.width=e.width*n,a.height=e.height*n,r.drawImage(e,0,0,a.width,a.height)}function A(e,t,a){for(var r=t.getContext("2d"),n=f(e),i=R(n,[-1,-2,-1,0,0,0,1,2,1]),d=R(n,[-1,0,1,-2,0,2,-1,0,1]),o=new Float32Array(n.width*n.height*4),h=new Float32Array(n.width*n.height*4),c=-1,l=0;l<n.data.length;l+=4){var g=i.data[l],u=d.data[l];o[l]=Math.sqrt(u*u+g*g),o[l]>c&&(c=o[l]),h[l]=Math.atan2(g,u)+Math.PI}var v=r.getImageData(0,0,t.width,t.height);for(l=0;l<v.data.length;l+=4){var s=C(h[l]/(2*Math.PI),a,o[l]/c);v.data[l]=s.r,v.data[l+1]=s.g,v.data[l+2]=s.b,v.data[l+3]=255}return v}function R(e,t){for(var a=Math.round(Math.sqrt(t.length)),r=Math.floor(a/2),n=e.data,i=e.width,d=e.height,o=i,h=d,c={width:o,height:h,data:new Float32Array(o*h*4)},l=c.data,g=0;g<h;g++)for(var u=0;u<o;u++){for(var v=g,s=u,f=4*(g*o+u),w=0,m=0,y=0,I=0,q=0;q<a;q++)for(var S=0;S<a;S++){var p=4*(Math.min(d-1,Math.max(0,v+q-r))*i+Math.min(i-1,Math.max(0,s+S-r))),M=t[q*a+S];w+=n[p]*M,m+=n[p+1]*M,y+=n[p+2]*M,I+=n[p+3]*M}l[f]=w,l[f+1]=m,l[f+2]=y,l[f+3]=I}return c}function C(e,t,a){var r,n,i,d,o,h,c,l;switch(1===arguments.length&&(t=e.s,a=e.v,e=e.h),h=a*(1-t),c=a*(1-(o=6*e-(d=Math.floor(6*e)))*t),l=a*(1-(1-o)*t),d%6){case 0:r=a,n=l,i=h;break;case 1:r=c,n=a,i=h;break;case 2:r=h,n=a,i=l;break;case 3:r=h,n=c,i=a;break;case 4:r=l,n=h,i=a;break;case 5:r=a,n=h,i=c}return{r:Math.round(255*r),g:Math.round(255*n),b:Math.round(255*i)}}k.addEventListener("click",function(){var e=x.getImageData(0,0,M.width,M.height);if(D)E(I,600,M,x),k.text="Apply",D=!1;else{var t=A(e,M,b.value);x.putImageData(t,0,0),k.text="Reload",D=!0}})}();