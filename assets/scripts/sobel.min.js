"use strict";!function(){var e=document.querySelector("#fig-greyscale"),a=e.querySelector("img"),r=e.querySelector("canvas"),n=e.querySelector(".button"),i=r.getContext("2d"),o=!1;function v(e){for(var t=e.data,a=0;a<t.length;a+=4){var r=.2126*t[a]+.7152*t[a+1]+.0722*t[a+2];t[a]=t[a+1]=t[a+2]=r}return e}n.addEventListener("click",function(){r.width=a.width,r.height=a.height,i.drawImage(a,0,0);var e=i.getImageData(0,0,r.width,r.height);if(o)n.innerHTML="Apply",o=!1;else{var t=v(e);i.putImageData(t,0,0),n.innerHTML="Reload",a.style="display:none;",r.style="display:block;",o=!0}});var t=document.querySelector("#fig-sobel"),h=t.querySelector("img"),l=t.querySelector("canvas"),d=t.querySelector(".button"),c=l.getContext("2d"),g=!1;d.addEventListener("click",function(){l.width=h.width,l.height=h.height,c.drawImage(h,0,0);var e=c.getImageData(0,0,l.width,l.height);if(g)d.innerHTML="Apply",g=!1;else{var t=A(e,l,0);c.putImageData(t,0,0),d.innerHTML="Reload",h.style="display:none;",l.style="display:block;",g=!0}});var u=document.querySelector("#fig-sobel-colour"),s=u.querySelector("img"),y=u.querySelector("canvas"),f=u.querySelector(".button"),w=y.getContext("2d"),m=!1;f.addEventListener("click",function(){y.width=s.width,y.height=s.height,w.drawImage(s,0,0);var e=w.getImageData(0,0,y.width,y.height);if(m)f.innerHTML="Apply",m=!1;else{var t=A(e,y,1);w.putImageData(t,0,0),f.innerHTML="Reload",s.style="display:none;",y.style="display:block;",m=!0}});var M,p=document.querySelector("#loader-tool"),q=p.querySelector("#select"),S=p.querySelector("#fileInput"),I=p.querySelector("canvas"),L=I.getContext("2d"),b=p.querySelector("#saturation"),k=p.querySelector("#saturationValueDisplay"),D=p.querySelector("#apply");b.addEventListener("change",function(e){k.innerHTML=b.value}),q.addEventListener("click",function(){S.click()}),S.addEventListener("change",function(e){var t=new FileReader;t.onload=function(e){(M=new Image).onload=function(){T(M,600,I,L)},M.src=e.target.result,D.style="display: inline;"};var a=e.target.files[0];a&&a.type.match("image.*")&&t.readAsDataURL(a)});var H=!1;function T(e,t,a,r){var n=1;(t<e.width||t<e.height)&&(n=Math.min(t/e.width,t/e.height)),a.width=e.width*n,a.height=e.height*n,r.drawImage(e,0,0,a.width,a.height)}function A(e,t,a){for(var r=t.getContext("2d"),n=v(e),i=x(n,[-1,-2,-1,0,0,0,1,2,1]),o=x(n,[-1,0,1,-2,0,2,-1,0,1]),h=new Float32Array(n.width*n.height*4),l=new Float32Array(n.width*n.height*4),d=-1,c=0;c<n.data.length;c+=4){var g=i.data[c],u=o.data[c];h[c]=Math.sqrt(u*u+g*g),h[c]>d&&(d=h[c]),l[c]=Math.atan2(g,u)+Math.PI}var s=r.getImageData(0,0,t.width,t.height);for(c=0;c<s.data.length;c+=4){var y=E(l[c]/(2*Math.PI),a,h[c]/d);s.data[c]=y.r,s.data[c+1]=y.g,s.data[c+2]=y.b,s.data[c+3]=255}return s}function x(e,t){for(var a=Math.round(Math.sqrt(t.length)),r=Math.floor(a/2),n=e.data,i=e.width,o=e.height,h=i,l=o,d={width:h,height:l,data:new Float32Array(h*l*4)},c=d.data,g=0;g<l;g++)for(var u=0;u<h;u++){for(var s=g,y=u,v=4*(g*h+u),f=0,w=0,m=0,M=0,p=0;p<a;p++)for(var q=0;q<a;q++){var S=4*(Math.min(o-1,Math.max(0,s+p-r))*i+Math.min(i-1,Math.max(0,y+q-r))),I=t[p*a+q];f+=n[S]*I,w+=n[S+1]*I,m+=n[S+2]*I,M+=n[S+3]*I}c[v]=f,c[v+1]=w,c[v+2]=m,c[v+3]=M}return d}function E(e,t,a){var r,n,i,o,h,l,d,c;switch(1===arguments.length&&(t=e.s,a=e.v,e=e.h),l=a*(1-t),d=a*(1-(h=6*e-(o=Math.floor(6*e)))*t),c=a*(1-(1-h)*t),o%6){case 0:r=a,n=c,i=l;break;case 1:r=d,n=a,i=l;break;case 2:r=l,n=a,i=c;break;case 3:r=l,n=d,i=a;break;case 4:r=c,n=l,i=a;break;case 5:r=a,n=l,i=d}return{r:Math.round(255*r),g:Math.round(255*n),b:Math.round(255*i)}}D.addEventListener("click",function(){var e=L.getImageData(0,0,I.width,I.height);if(H)T(M,600,I,L),D.innerHTML="Apply",H=!1;else{var t=A(e,I,b.value);L.putImageData(t,0,0),D.innerHTML="Reload",H=!0}})}();