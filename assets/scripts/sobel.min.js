"use strict";!function(){var t=document.querySelector("#fig-greyscale"),a=t.querySelector("img"),r=t.querySelector("canvas"),n=t.querySelector(".button");r.width=a.width,r.height=a.height;var i=r.getContext("2d");a.addEventListener("load",function(){i.drawImage(a,0,0)});var o=!1;function f(t){for(var e=t.data,a=0;a<e.length;a+=4){var r=.2126*e[a]+.7152*e[a+1]+.0722*e[a+2];e[a]=e[a+1]=e[a+2]=r}return t}n.addEventListener("click",function(){var t=i.getImageData(0,0,r.width,r.height);if(o)i.drawImage(a,0,0),n.text="Apply",o=!1;else{var e=f(t);i.putImageData(e,0,0),n.text="Reload",o=!0}});var e=document.querySelector("#fig-sobel"),h=e.querySelector("img"),d=e.querySelector("canvas"),c=e.querySelector(".button");d.width=h.width,d.height=h.height;var l=d.getContext("2d");h.addEventListener("load",function(){l.drawImage(h,0,0)});var g=!1;c.addEventListener("click",function(){var t=l.getImageData(0,0,d.width,d.height);if(g)l.drawImage(h,0,0),c.text="Apply",g=!1;else{var e=A(t,d,0);l.putImageData(e,0,0),c.text="Reload",g=!0}});var u=document.querySelector("#fig-sobel-colour"),v=u.querySelector("img"),s=u.querySelector("canvas"),w=u.querySelector(".button");s.width=v.width,s.height=v.height;var y=s.getContext("2d");v.addEventListener("load",function(){y.drawImage(v,0,0)});var m=!1;w.addEventListener("click",function(){var t=y.getImageData(0,0,s.width,s.height);if(m)y.drawImage(v,0,0),w.text="Apply",m=!1;else{var e=A(t,s,1);y.putImageData(e,0,0),w.text="Reload",m=!0}});var q,I=document.querySelector("#loader-tool"),S=I.querySelector("#select"),p=I.querySelector("#fileInput"),M=I.querySelector("canvas"),x=M.getContext("2d"),b=I.querySelector("#saturation"),L=I.querySelector("#saturationValueDisplay"),k=I.querySelector("#apply");b.addEventListener("change",function(t){L.innerHTML=b.value}),S.addEventListener("click",function(){p.click()}),p.addEventListener("change",function(t){var e=new FileReader;e.onload=function(t){(q=new Image).onload=function(){E(q,600,M,x)},q.src=t.target.result,k.style="display: inline;"};var a=t.target.files[0];a&&a.type.match("image.*")&&e.readAsDataURL(a)});var D=!1;function E(t,e,a,r){var n=1;(e<t.width||e<t.height)&&(n=Math.min(e/t.width,e/t.height)),a.width=t.width*n,a.height=t.height*n,r.drawImage(t,0,0,a.width,a.height)}function A(t,e,a){for(var r=e.getContext("2d"),n=f(t),i=R(n,[-1,-2,-1,0,0,0,1,2,1]),o=R(n,[-1,0,1,-2,0,2,-1,0,1]),h=new Float32Array(n.width*n.height*4),d=new Float32Array(n.width*n.height*4),c=-1,l=0;l<n.data.length;l+=4){var g=i.data[l],u=o.data[l];h[l]=Math.sqrt(u*u+g*g),h[l]>c&&(c=h[l]),d[l]=Math.atan2(g,u)+Math.PI}var v=r.getImageData(0,0,e.width,e.height);for(l=0;l<v.data.length;l+=4){var s=C(d[l]/(2*Math.PI),a,h[l]/c);v.data[l]=s.r,v.data[l+1]=s.g,v.data[l+2]=s.b,v.data[l+3]=255}return v}function R(t,e){for(var a=Math.round(Math.sqrt(e.length)),r=Math.floor(a/2),n=t.data,i=t.width,o=t.height,h=i,d=o,c={width:h,height:d,data:new Float32Array(h*d*4)},l=c.data,g=0;g<d;g++)for(var u=0;u<h;u++){for(var v=g,s=u,f=4*(g*h+u),w=0,y=0,m=0,q=0,I=0;I<a;I++)for(var S=0;S<a;S++){var p=4*(Math.min(o-1,Math.max(0,v+I-r))*i+Math.min(i-1,Math.max(0,s+S-r))),M=e[I*a+S];w+=n[p]*M,y+=n[p+1]*M,m+=n[p+2]*M,q+=n[p+3]*M}l[f]=w,l[f+1]=y,l[f+2]=m,l[f+3]=q}return c}function C(t,e,a){var r,n,i,o,h,d,c,l;switch(1===arguments.length&&(e=t.s,a=t.v,t=t.h),d=a*(1-e),c=a*(1-(h=6*t-(o=Math.floor(6*t)))*e),l=a*(1-(1-h)*e),o%6){case 0:r=a,n=l,i=d;break;case 1:r=c,n=a,i=d;break;case 2:r=d,n=a,i=l;break;case 3:r=d,n=c,i=a;break;case 4:r=l,n=d,i=a;break;case 5:r=a,n=d,i=c}return{r:Math.round(255*r),g:Math.round(255*n),b:Math.round(255*i)}}k.addEventListener("click",function(){var t=x.getImageData(0,0,M.width,M.height);if(D)E(q,600,M,x),k.text="Apply",D=!1;else{var e=A(t,M,b.value);x.putImageData(e,0,0),k.text="Reload",D=!0}})}();