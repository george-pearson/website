"use strict";$(document).ready(function(){var M,a=Math.pow(2,9)+1;function t(a){(M=function(a,t){for(var r=[],o=0;o<a;o++)r[o]=[];for(var o=0;o<a;o++)for(var n=0;n<t;n++)r[o][n]=0;return r}(a,a))[0][0]=2*Math.random()-1,M[0][a-1]=2*Math.random()-1,M[a-1][0]=2*Math.random()-1,M[a-1][a-1]=2*Math.random()-1;for(var t=a-1,r=1,o=1;1<t;){for(var n,e,i,g,l,f,c,d,h,v,m,u=Math.round(t/2),p=[[-1,0],[1,0],[0,-1],[0,1]],s=0;s<r;s++)for(var $=0;$<r;$++)e=(s+1)*t,g=($+1)*t,f=(i=$*t)+u,M[l=(n=s*t)+u][f]=(M[i][n]+M[i][e]+M[g][n]+M[g][e])/4,M[l][f]+=o*(2*Math.random()-1);for(s=0;s<2*r+1;s++){l=u*s;for($=0;$<2*r+1;$++)if(f=t*$+u*(1-s%2),l<a&&0<l&&f<a&&0<f){for(var I=d=c=0;I<p.length;I++)h=p[I][0],m=f+p[I][1]*u,(v=l+h*u)<a&&0<v&&m<a&&0<m&&(c+=M[v][m],d+=1);M[l][f]+=c/d+o*(2*Math.random()-1)}}t=u,r*=2,o/=2}for(s=0;s<a;s++)for($=0;$<a;$++)M[s][$]=(M[s][$]+1)/2,M[s][$]<0&&(M[s][$]=0),1<M[s][$]&&(M[s][$]=1);return M}function r(a){for(var t,r,o=$("#myCanvas")[0],n=o.getContext("2d"),e=n.getImageData(0,0,a.length,a.length),i=(t=$("#color1").val(),(r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t))?{r:parseInt(r[1],16),g:parseInt(r[2],16),b:parseInt(r[3],16)}:null),g=0;g<a.length;g++)for(var l=0;l<a.length;l++){var f=4*(g+l*a.length);e.data[f+0]=i.r*a[g][l],e.data[f+1]=i.g*a[g][l],e.data[f+2]=i.b*a[g][l],e.data[f+3]=255*a[g][l]}n.canvas.width=a.length,n.canvas.height=a.length,n.putImageData(e,0,0);var c=function(a,t){var r,o=a.getContext("2d"),n=a.width,e=a.height;if(t){r=o.getImageData(0,0,n,e);var i=o.globalCompositeOperation;o.globalCompositeOperation="destination-over",o.fillStyle=t,o.fillRect(0,0,n,e)}var g=a.toDataURL("image/jpeg");t&&(o.clearRect(0,0,n,e),o.putImageData(r,0,0),o.globalCompositeOperation=i);return g}(o,$("#color2").val());$("#divImg").empty(),$("#divImg").append("<img src='"+c+"'>")}$("#color1").on("change",function(){M||(M=t(a)),r(M)}),$("#color2").on("change",function(){M||(M=t(a)),r(M)}),$("#reload").click(function(){r(M=t(a))})});